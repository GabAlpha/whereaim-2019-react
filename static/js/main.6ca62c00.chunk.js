(this.webpackJsonpreactwiam=this.webpackJsonpreactwiam||[]).push([[0],{317:function(e,t,n){e.exports=n(513)},322:function(e,t,n){},323:function(e,t,n){},513:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(57),i=n.n(r),c=(n(322),n(323),n(324),n(47)),l=n(48),s=n(49),u=n(50),p=n(52),d=n(27),h=n.n(d),m=(n(325),n(326),n(25)),f=0,g=function(e){return function(t){t(v());var n=new URL("https://nominatim.openstreetmap.org/search"),a={q:e.inputValue,format:"json",limit:"4"};n.search=new URLSearchParams(a);return fetch("https://cors-anywhere.herokuapp.com/"+n).then((function(e){return e.json()})).then((function(e){return t(b(e))})).catch((function(e){return console.error(e)}))}},b=function(e){return function(t){var n=function(e,t){var n=[],a=!0,o=!1,r=void 0;try{for(var i,c=e[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var l=i.value;n.push({title:l.display_name,description:l.place_id,displayposition:{lat:l.lat,lng:l.lon}})}}catch(s){o=!0,r=s}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}return n}(e);t(y(n))}},y=function(e){return{type:"RECEIVE_GEOCODE_RESULTS",results:e}},v=function(e){return Object(m.a)({type:"REQUEST_GEOCODE_RESULTS"},e)},E=function(e){return{type:"UPDATE_TEXTINPUT",payload:e}},w=function(e,t,n,a){return function(o){var r=function(e){return e.features.length>0?e.features:[]}(e);o(C({data:r,category:t,boundingbox:n,color:a})),f=r}},C=function(e){return{type:"RECEIVE_PLACES_RESULTS",payload:e}},O=function(e){return{type:"REQUEST_PLACES_RESULTS",payload:e}},R=function(e){return function(t){t(S(e))}},S=function(e){return{type:"UPDATE_BBOX",payload:e}},j=1,L=function(e,t){return function(n){var a=new URL("https://it.wikipedia.org/w/api.php"),o={action:"query",titles:t,prop:"extracts",format:"json",exchars:150};a.search=new URLSearchParams(o),fetch("https://cors-anywhere.herokuapp.com/"+a).then((function(e){return e.json()})).then((function(t){return n(k(e,t.query.pages[Object.keys(t.query.pages)[0]].extract))})).catch((function(e){return console.error(e)}))}},k=function(e,t){return{type:"RECEIVE_INFO",urlfoto:e,urldescrzione:t}},x=function(){return{type:"WIKI_CLEAR"}},T=n(69),_=n(267),U=n.n(_),I=n(155),D=n.n(I),A=[],P={q:"nodejs",part:"snippet",type:"video",maxResults:30};var M=[],F={width:"100%",height:"100vh"},z={center:[0,0],zoomControl:!1,maxBounds:h.a.latLngBounds(h.a.latLng(-90,-180),h.a.latLng(90,180)),zoom:3},B={},V=h.a.featureGroup(),G=h.a.featureGroup(),N=function(e){function t(){return Object(c.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=h.a.map("map",z);var t=this.props.dispatch;B=this.map,h.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),this.map.addLayer(V),this.map.addLayer(G),this.map.createPane("clusterPane").style.opacity=.9,h.a.control.zoom({position:"topright"}).addTo(this.map),h.a.control.locate({position:"bottomleft"}).addTo(this.map),this.map.on("moveend",(function(){t(R(e.map.getBounds())),t((function(e){f.length>1e3&&(e({type:"CLEAR"}),f={},e({type:"RESULT_HANDLER",payload:{type:"warning",icon:"warning",description:"Hai raggiunto il limite di 1000 elementi su schermo"}}))}))})),t(R(this.map.getBounds()))}},{key:"componentDidUpdate",value:function(e){var t=this.props.lastCall,n=this.props.isochronesControls;t>e.lastCall&&this.addPlaces(),n.userInput===e.isochronesControls.userInput&&""!==n.userInput||this.addIsochronesCenter()}},{key:"addIsochronesCenter",value:function(){G.clearLayers();var e=this.props.isochronesControls.settings.isochronesCenter;e.lat&&e.lng&&(h.a.circleMarker(e).addTo(G).bindTooltip("latitude: "+e.lat+", longitude: "+e.lng,{permanent:!1}),this.map.setView(e,14))}},{key:"addPlaces",value:function(){V.clearLayers();var e=this.props.places,t=0;for(var n in e)if(e[n].hasOwnProperty("data")&&e[n].data.length>0){var a=!0,o=!1,r=void 0;try{for(var i,c=e[n].data[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var l=i.value,s='<a href="https://www.wikidata.org/wiki/'+l.properties.wikidata+'" target="_blank">'+l.properties.name+"</a>";0!==l.properties.rate&&M.push(h.a.circleMarker([l.geometry.coordinates[1],l.geometry.coordinates[0]],{radius:10,id:t,weight:1,opacity:.5}).addTo(V).bindPopup(void 0!==l.properties.wikidata?s:l.properties.name)),t+=1}}catch(u){o=!0,r=u}finally{try{a||null==c.return||c.return()}finally{if(o)throw r}}}!function(e){var t=D.a.encode(B.getCenter().lat,B.getCenter().lng,6).replace("+","");P.q=t,U()("AIzaSyCiM_SrbJEhuio-wi0mZXI07T-vvZuSGdY",P,(function(t,n){if(void 0!==n){var a=n.items.map((function(e){return e.snippet.description.slice(20,31)}));a=a.filter(Boolean),(A=a.map((function(e){return{geometry:{coordinates:[D.a.decode(e).longitudeCenter,D.a.decode(e).latitudeCenter]},id:"youtube"}}))).map((function(e){return f.unshift(e)})),e()}else console.log(t)}))}((function(){A.map((function(e){h.a.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],{radius:10,opacity:.5,weight:1,color:"#f5426c"}).addTo(V).bindPopup("Youtube")}))}))}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",{id:"map",style:F}))}}]),t}(o.a.Component),W=Object(T.b)((function(e){var t=e.placesControls;return{places:t.places,lastCall:t.lastCall,isochronesControls:e.isochronesControls}}))(N),q=n(66),H=n(103),J=n(553),X=n(552),Q=n(195),K=n(193),Y=n(300),Z=n(303),$=n(299),ee=new(n.n($).a)({bitrate:128}),te="",ne="",ae=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).start=function(){n.state.bloccato?alert("no deh non va"):ee.start().then((function(){n.setState({staRegistrando:!0})})).catch((function(e){return console.log("ERRORE")}))},n.stop=function(){ee.stop().getMp3().then((function(e){var t=Object(Z.a)(e,2),a=(t[0],t[1]),o=URL.createObjectURL(a);n.setState({blobURL:o,staRegistrando:!1});var r=new FileReader;r.readAsDataURL(a),r.onloadend=function(){ne=r.result}})).catch((function(e){return console.log(e)}))},n.clear=function(){localStorage.clear(),window.location.reload(!1)},n.saveAudio=function(){(0,n.props.dispatch)({type:"ADD_AUDIO",id:j++,blobAudio:ne}),console.log("File salvato"),window.location.reload(!1)},n.state={staRegistrando:!1,blobURL:"",bloccato:!1},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0},(function(){console.log("Daje de Permesso"),e.setState({bloccato:!1})}),(function(){console.log("noo deee"),e.setState({bloccato:!0})}))}},{key:"render",value:function(){return o.a.createElement("div",null,""===this.state.blobURL?[]:o.a.createElement("audio",{src:this.state.blobURL,controls:"controlli"}),o.a.createElement("div",null,o.a.createElement(H.a,{circular:!0,color:"purple",onClick:this.start,disabled:this.state.staRegistrando},"Registra"),o.a.createElement(H.a,{circular:!0,color:"purple",onClick:this.stop,disabled:!this.state.staRegistrando},"Stop"),o.a.createElement(H.a,{circular:!0,color:"purple",onClick:this.clear},"Cancella Tutto"),o.a.createElement(H.a,{circular:!0,color:"purple",onClick:this.saveAudio},"Salva Internamente")),te.blob64.map((function(e){return o.a.createElement("div",null,o.a.createElement("audio",{src:e,controls:"controlli"}))})))}}]),t}(o.a.Component),oe=Object(T.b)((function(e){return{audioState:te=e.audio}}))(ae),re={0:{name:"POI",color:"red"}},ie=" ",ce=-1,le={zIndex:999,position:"absolute",width:"400px",top:"10px",left:"10px",maxHeight:"calc(100vh - 5vw)",padding:"20px",overflow:"auto"},se={zIndex:999,position:"absolute",width:"200px",top:"86vh",left:"50%",marginLeft:"-100px",overflow:"auto",padding:"10px"},ue=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).handleSearchChange=function(e){var t=n.props,a=t.dispatch;0===t.userTextInput.length&&a(g({inputValue:""})),a(E({inputValue:e.target.value})),n.fetchGeocodeResults()},n.handleResultSelect=function(e,t){var a,o=t.result,r=n.props.dispatch;r(E({inputValue:o.title})),r((a={isochronesCenter:o.displayposition},Object(m.a)({type:"UPDATE_CENTER"},a)))},n.handleClick=function(e,t){var a;ce=-1,M.length=0,(0,n.props.dispatch)((a={category:t.value,color:t.color},function(e,t){e(O({category:a.category}));var n=t().placesControls.boundingbox,o=new URL("http://api.opentripmap.com/0.1/en/places/bbox"),r={lon_min:n.lonMin,lat_min:n.latMin,lon_max:n.lonMax,lat_max:n.latMax,format:"geojson",apikey:"5ae2e3f221c38a28845f05b637122877ed798c08259996c2c5be7388"};return o.search=new URLSearchParams(r),fetch("https://cors-anywhere.herokuapp.com/"+o).then((function(e){return e.json()})).then((function(t){return e(w(t,a.category,n,a.color))})).catch((function(e){return console.error(e)}))}))},n.nextButton=function(){var e,t=n.props.dispatch;ce++,"youtube"===f[ce].id?(B.setView(new h.a.LatLng(f[ce].geometry.coordinates[1],f[ce].geometry.coordinates[0]),19),M[ce].openPopup()):(t((e=f[ce].properties.wikidata,function(t){t(x());var n=new URL("https://inventaire.io/api/entities"),a="wd:"+e,o={action:"by-uris",uris:a};n.search=new URLSearchParams(o),fetch(n).then((function(e){return e.json()})).then((function(e){return t(L(e.entities[a].image.url,e.entities[a].sitelinks.itwiki))})).catch((function(e){return console.error(e)}))})),B.setView(new h.a.LatLng(f[ce].geometry.coordinates[1],f[ce].geometry.coordinates[0]),19),ie=f[ce].properties.name,M[ce].openPopup()),console.log(f[ce])},n.prevButton=function(){ce--,B.setView(new h.a.LatLng(f[ce].geometry.coordinates[1],f[ce].geometry.coordinates[0]),19),M[ce].openPopup()},n.handleClickClear=function(){(0,n.props.dispatch)({type:"CLEAR"})},n.setEditormode=function(){n.setState({editorMode:!0})},n.setBrowsermode=function(){n.setState({editorMode:!1})},n.componentDidUpdate=function(e){var t=n.props.message;t.receivedAt>e.message.receivedAt&&Object(K.toast)({type:t.type,icon:t.icon,title:t.topic,description:t.description,time:5e3})},n.areButtonsDisabled=function(e){var t=!0;for(var n in e)e.hasOwnProperty(n)&&e[n].hasOwnProperty("data")&&e[n].data.length>0&&(t=!1);return t},n.handleSearchChange=n.handleSearchChange.bind(Object(q.a)(n)),n.fetchGeocodeResults=Object(Y.a)(1e3,n.fetchGeocodeResults),n.state={editorMode:!1},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"fetchGeocodeResults",value:function(){var e=this.props,t=e.dispatch,n=e.userTextInput;n.length>0&&t(g({inputValue:n}))}},{key:"componentDidMount",value:function(){(0,this.props.dispatch)(x())}},{key:"render",value:function(){var e,t=this,n=this.props.places,a=this.state.editorMode,r=function(e){var t=e.content,n=e.circular,a=e.handler,r=e.icon,i=e.disabled,c=e.basic,l=e.size,s=e.loading,u=e.color,p=e.value,d=e.fluid;return o.a.createElement(H.a,{color:u,circular:n,content:t,loading:s,size:l,onClick:a,basic:c,disabled:i,icon:r,value:p,fluid:d})},i=this.props,c=i.isFetching,l=i.userTextInput,s=i.results,u=i.urlDescrzione,p=i.urlFoto;return e=a?o.a.createElement("div",null,o.a.createElement(H.a,{onClick:this.setBrowsermode,color:"purple",icon:"plus"}),o.a.createElement(oe,null)):o.a.createElement("div",null,o.a.createElement("div",{className:"flex justify-between items-center mt3"},o.a.createElement(J.a,{onSearchChange:this.handleSearchChange,onResultSelect:this.handleResultSelect,type:"text",input:{fluid:!0},fluid:!0,loading:c,className:"flex-grow-1 mr2",results:s,value:l,placeholder:"Find Address ..."}),o.a.createElement(H.a,{circular:!0,color:"purple",icon:"plus",onClick:this.setEditormode}),o.a.createElement(H.a,{circular:!0,color:"purple",icon:"delete",onClick:this.handleClickClear})),""!==u?o.a.createElement("div",null,o.a.createElement(X.a,null),o.a.createElement("h2",null,ie),o.a.createElement(X.a,null),o.a.createElement("img",{src:""!==p?p:"",width:"300"}),o.a.createElement(X.a,null),o.a.createElement("p",{dangerouslySetInnerHTML:{__html:u}})):""),o.a.createElement("div",null,o.a.createElement(Q.a,{style:le},o.a.createElement("div",null,o.a.createElement("span",null,"Benvenuto su ",o.a.createElement("strong",null,"Where I AM")," by ",o.a.createElement("strong",null,"Gabriele Alfarano"))),o.a.createElement(X.a,null),e),o.a.createElement(Q.a,{style:se,textAlign:"center"},o.a.createElement("div",null,Object.keys(re).map((function(e,a){return o.a.createElement("div",null,o.a.createElement(r,{icon:"angle left icon",disabled:!1,handler:t.prevButton,color:"basic blue",loading:null,size:"tiny",circular:!0}),o.a.createElement(r,{icon:"search icon",value:re[e].name,disabled:!1,handler:t.handleClick,color:"blue",loading:!!n[re[e].name]&&n[re[e].name].isFetching,size:"large",circular:!0}),o.a.createElement(r,{icon:"angle right icon",disabled:!1,handler:t.nextButton,color:"basic blue",loading:null,size:"tiny",circular:!0}))})))),o.a.createElement(K.SemanticToastContainer,{position:"bottom-center"}))}}]),t}(o.a.Component),pe=Object(T.b)((function(e){var t=e.placesControls,n=t.places,a=t.message,o=e.isochronesControls.userInput,r=e.isochronesControls.geocodeResults,i=e.isochronesControls.isFetching,c=e.infoWiki;return{places:n,message:a,userTextInput:o,results:r,isFetching:i,urlFoto:c.urlFoto,urlDescrzione:c.urlDescrzione}}))(ue);var de=function(){return o.a.createElement("div",null,o.a.createElement(W,null),o.a.createElement(pe,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var he=n(67),me=n(301),fe=n(302),ge=n(198),be=n(36),ye={userInput:"",geocodeResults:[],isochrones:{results:[]},isFetching:!1,isFetchingIsochrones:!1,settings:{isochronesCenter:{},range:{max:500,value:60},interval:{max:60,value:10},mode:"car",rangetype:"distance",traffic:"disabled"}},ve={boundingbox:{lonMin:"",latMin:"",lonMax:"",latMax:""},message:{receivedAt:0},lastCall:Date.now(),places:{}},Ee=Object(he.combineReducers)({placesControls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,t=arguments.length>1?arguments[1]:void 0;switch(t.type){default:return e;case"REQUEST_PLACES_RESULTS":return Object(m.a)({},e,{places:Object(m.a)({},e.places,Object(be.a)({},t.payload.category,Object(m.a)({},e.places,{isFetching:!0})))});case"RECEIVE_PLACES_RESULTS":return Object(m.a)({},e,{lastCall:Date.now(),places:Object(m.a)({},e.places,Object(be.a)({},t.payload.category,Object(m.a)({},e.places[t.payload.category],{data:e.places[t.payload.category].hasOwnProperty("data")?[].concat(Object(ge.a)(e.places[t.payload.category].data),Object(ge.a)(t.payload.data)):t.payload.data,boundingbox:t.payload.boundingbox,color:t.payload.color,isFetching:!1})))});case"CLEAR":return Object(m.a)({},e,{places:{},lastCall:Date.now(),lastCompute:Date.now()});case"UPDATE_BBOX":return Object(m.a)({},e,{boundingbox:{lonMin:t.payload._southWest.lng,latMin:t.payload._southWest.lat,lonMax:t.payload._northEast.lng,latMax:t.payload._northEast.lat}});case"RESULT_HANDLER":return Object(m.a)({},e,{message:Object(m.a)({},e.message,{},t.payload,{receivedAt:Date.now()})})}},isochronesControls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye,t=arguments.length>1?arguments[1]:void 0;switch(t.type){default:return e;case"UPDATE_TEXTINPUT":return Object(m.a)({},e,{userInput:t.payload.inputValue});case"REQUEST_GEOCODE_RESULTS":return Object(m.a)({},e,{isFetching:!0});case"RECEIVE_GEOCODE_RESULTS":return Object(m.a)({},e,{geocodeResults:t.results,isFetching:!1});case"UPDATE_CENTER":return Object(m.a)({},e,{settings:Object(m.a)({},e.settings,{isochronesCenter:t.isochronesCenter})})}},audio:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:0,blob64:[]},t=arguments.length>1?arguments[1]:void 0;switch(t.type){default:return e;case"ADD_AUDIO":return e.id=t.id,e.blob64.push(t.blobAudio),e}},infoWiki:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{urlFoto:"",urlDescrzione:""},t=arguments.length>1?arguments[1]:void 0;switch(t.type){default:return e;case"RECEIVE_INFO":return{urlFoto:t.urlfoto,urlDescrzione:t.urldescrzione};case"WIKI_CLEAR":return{urlFoto:"",urlDescrzione:""}}}}),we=[fe.a],Ce=function(){try{var e=localStorage.getItem("state");if(null===e)return;return JSON.parse(e)}catch(t){return}}(),Oe=Object(he.createStore)(Ee,Ce,Object(me.composeWithDevTools)(he.applyMiddleware.apply(void 0,we)));Oe.subscribe((function(){!function(e){try{var t=JSON.stringify(e);localStorage.setItem("state",t)}catch(n){}}(Oe.getState())})),i.a.render(o.a.createElement(T.a,{store:Oe},o.a.createElement(de,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[317,1,2]]]);
//# sourceMappingURL=main.6ca62c00.chunk.js.map